<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE project PUBLIC "-//ANT//DTD project//EN" "misc/project.dtd" >

<project name="TOML" default="main" basedir="..">
	<property name="local.install.dir" value="install"/>
	<property name="local.install.path" value="${local.install.dir}/classes"/>
	<property name="local.jar.dir" value="${local.install.dir}/lib"/>
	
	<property name="install.dir" value="${basedir}/install"/>
	<property name="install.dir.lib" value="${install.dir}/lib"/>
	
	<property name="toml.dir" value="${basedir}/TOML"/>
	<property name="toml.jar" value="${toml.dir}/${local.jar.dir}/toml.jar"/>
	<property name="toml.schema.dir" value="${toml.dir}/schema"/>
	<property name="toml.src.dir" value="${toml.dir}/src"/>
	<property name="toml.install.dir" value="${toml.dir}/${local.install.dir}"/>
	<property name="toml.install.path" value="${toml.dir}/${local.install.path}"/>

	<property name="path.to.schema" value="${basedir}/OT/cfg/schema"/>
	<property name="ukirt.schema" value="${path.to.schema}/JAC/UKIRT/UKIRT.xsd"/>
	<property name="jcmt.schema" value="${path.to.schema}/JAC/JCMT/JCMT.xsd"/>
	<property name="schema.java.path" value="edu.hawaii.jach.omp.toml"/>
	<property name="ukirt.java.path" value="${schema.java.path}.ukirt"/>
	<property name="jcmt.java.path" value="${schema.java.path}.jcmt"/>

	<target name="clean">
		<delete dir="${toml.schema.dir}"/>
		<delete dir="${toml.dir}/${local.jar.dir}"/>
		<delete dir="${toml.install.path}"/>
		<delete dir="${toml.install.dir}"/>
		<delete dir="${toml.jar}"/>
	</target>

	<target name="mkdir" depends="clean">
		<mkdir dir="${toml.schema.dir}"/>
		<mkdir dir="${toml.install.dir}"/>
		<mkdir dir="${toml.install.path}"/>
		<mkdir dir="${toml.dir}/${local.jar.dir}"/>
	</target>

	<target name="toml" depends="mkdir">
		<exec executable="xjc">
			<arg value="-verbose"/>
			<arg value="-d"/>
			<arg value="${toml.schema.dir}"/>
			<arg value="-p"/>
			<arg value="${ukirt.java.path}"/>
			<arg value="${ukirt.schema}"/>
                </exec>
		<exec executable="xjc">
			<arg value="-verbose"/>
			<arg value="-d"/>
			<arg value="${toml.schema.dir}"/>
			<arg value="-p"/>
			<arg value="${jcmt.java.path}"/>
			<arg value="${jcmt.schema}"/>
                </exec>
		<javac srcdir="${toml.schema.dir}"
		       destdir="${toml.install.path}"
		       debug="on"
		       target="1.6">
		</javac>
		<javac srcdir="${toml.src.dir}"
		       destdir="${toml.install.path}"
		       debug="on"
		       target="1.6">
		</javac>
		<jar jarfile="${toml.jar}"
		     basedir="${toml.install.path}">
		</jar>
	</target>

	<target name="copy" depends="toml">
		<copy file="${toml.jar}" todir="${install.dir.lib}" />
	</target>

	<target name="main" depends="copy">
		<echo message="Done"/>
	</target>
</project>
