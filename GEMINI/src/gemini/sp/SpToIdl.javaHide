// Copyright 1997 Association for Universities for Research in Astronomy, Inc.,
// Observatory Control System, Gemini Telescopes Project.
// See the file COPYRIGHT for complete details.
//
// $Id$
//
package gemini.sp;

import java.util.*;
import ScienceProgram.*;

/**
 * This utility class converts from the Java representation of Science
 * Programs (Plans) to the IDL representation.
 *
 * <b>This class will change when we move away from Joe.</b>
 */
public final class SpToIdl
{

/**
 * Convert the Attribute/Value table of an item.
 */
public static ScienceProgram.AvPair[]
convertAV(SpAvTable avTab)
{
   int size = avTab.size();
   ScienceProgram.AvPair[] idlAvList = new ScienceProgram.AvPair[size];

   Enumeration keys = avTab.attributes();
   for (int i=0; keys.hasMoreElements(); ++i) {
      String key   = (String) keys.nextElement();
      String descr = avTab.getDescription(key);
      Vector v     = avTab.getAll(key);

      String[] values = new String[v.size()];
      v.copyInto(values);
      idlAvList[i] = new ScienceProgram.AvPair(key, descr, values);
   }

   return idlAvList;
}


/**
 * Convert the children of an item.
 */
public static ScienceProgram.Item[]
convertChildren(SpItem spParent)
{
   int size = spParent.childCount();
   ScienceProgram.Item[] idlChildren = new ScienceProgram.Item[size];

   Enumeration spChildren = spParent.children();
   for (int i=0; spChildren.hasMoreElements(); ++i) {
      SpItem child   = (SpItem) spChildren.nextElement();
      idlChildren[i] = SpToIdl.convert(child);
   }

   return idlChildren;
}


/**
 * Convert any SpItem to its IDL representation.
 */
public static ScienceProgram.Item
convert(SpItem spItem)
{
   ScienceProgram.Item idlItem = new ScienceProgram.Item();

   idlItem.name     = spItem.name();
   idlItem.type     = spItem.typeStr();
   idlItem.subtype  = spItem.subtypeStr();
   idlItem.av       = SpToIdl.convertAV(spItem.getTable());
   idlItem.children = SpToIdl.convertChildren(spItem);

   return idlItem;
}

}

