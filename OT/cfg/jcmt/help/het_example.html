<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"> <html>
  <head>
    <title>Preparing heterodyne observation files (MSBs)</title>
  </head>

<body text="#000000" bgcolor="#bbcccc" link="#003300" vlink="#005500" 
alink="# ff0000">

<h4> <a href="otintro.html"> <em>Back to JCMT OT Primer Main Page</em></a> 
</h4>

<h1>Preparing Heterodyne observations </h1> <!-- 
############################################################################ 
-->

<h2>Contents</h2> <li>A Guided Tour of an Example MSB (Beam-Switched 
<i>Sample</i>)
 <ul>
 <li><a href="#het_anat"> Anatomy of a beam-switched MSB </a>
 <li><a href="#ria">Really Important Aside - or is it Inside? </a>
 <li><a href="#het_eoam">Elements of an MSB</a>
 <li><a href="#het_thsc">The Het Setup component</a>
 <li><a href="#het_tsc">Site Quality</a>
 <li><a href="#het_tsched">Scheduling Constraints</a>
 <li><a href="#het_tfoc">The Observation component</a>
 <li><a href="#thingies">Components, Iterators And All That</a>
 <li><a href="#het_tcc">The target component</a>
 <li><a href="#het_tpe">The position editor</a>
 <li><a href="#het_tci">The chop iterator</a>
 <li><a href="#het_offset">The offset iterator</a>
 <li><a href="#het_sample">The photom/sample eye</a>
 <li><a href="#het_time">The repeat iterator and integration time in 
general</a>
 <li> <a href="#het_note">Adding a note</a>
 <li><a href="#het_summary">Summary: Making your heterodyne MSB.</a>
 <li><a href="#het_freq_ed"> The frequency editor</a> <p>
 </ul> <li><a href="#het_msblib">The Heterodyne MSB library</a>

 <ul>
 <li><a href="#het_sam_folder">Samples</a>
 <li><a href="#het_grid_folder">Grid Maps</a>
 <li><a href="#het_jig_folder">Jiggle Maps</a>
 <li><a href="#het_rast_folder">Raster Maps</a>
 </ul>


</ul>


<h2><a name="het_anat">Guided Tour of an Example MSB (Beam-Switched 
Sample) </a> </h2>

    Go to the JCMT root window, and open the ACSIS library by clicking on 
:<p>

   <img src="het_images/het_library.gif" alt="Contents of the
		heterodyne library"><p>

       A window will pop up containing a list of folders. The
    little switch on the left of the folder icons is an open/close
    toggle switch. Push open the folder titled "Samples" and then
    select the MSB labeled "Beam-switch sample(1X) " and click "Copy" on 
the toolbar.<p>

    <img src="het_images/het_copy.gif" alt="Copying an MSB" ><p>

      Now go back to your Science Program window, and click on
      "Paste". The MSB will be dropped into your science
      program. Congratulations! You're now well underway. Now is a
      good time to save your progress, so use the File->Save option in
      your Science Program window and carry on. <!-- 
############################################################################ 
-->

    <h2><a name="ria">Really Important Aside - or is it Inside? </a></h2>

Do you see how the icon for the MSB is not directly below the icon for the 
Science Program but indented to the right? That's because the MSB is 
<em>inside</em> the Science Program. This is a classic way of representing 
a hierarchical structure, and many of you will be familiar with it from 
other applications, such as the "Manage Bookmarks" screen in the Netscape 
and Mozilla browsers.


    <h2><a name="het_etmc">Editing the MSB component</a></h2>

    <p> Click on the title of the MSB. This will activate the MSB
    editor panel on the right section of your window.<p>


      The properties of an MSB are very simple.

      <ul>

      <li>It has a title, at the moment "Beam-switch sample".  When
 preparing your own MSB, this title should be changed to something
 meaningful describing the observation, usually with target
 name. Examples might be "B/SW observation of OMC1" or "3 point grid
 of M83". <strong>Please</strong> take the time to do this - it
      really helps the person doing the observing.

      <li>A pull down menu with a repeat counter. Leave that to 1 for
      the time being.

      <li>The priority of the MSB. Note that this only affects the
      internal priority of your MSBs - not the priority allocated to
      your entire project by your TAG. So if you had two different
      MSBs that rose to the top of the scheduling queue and one had
      priority "1" and the other "99", the one marked "1" will
      normally get done first. If all your MSBs are of equal interest
      to you, just don't bother changing the default.

	<small>Small print: Bear in mind though that MSB selection is
	an operational decision - marking your MSBs with priorities 1,
	2, 3 etc is no guarantee that they will be done in precisely
	that particular order. For example, your lower-priority MSBs
	could be done because they are observable at a time of day
	where there is not much else in the queue, whereas your
	high-priority MSBs could be competing against the top-ranked
	project. Also, the observer/TSS may sometimes select a lower
	priority MSB because it is the most efficient choice at the
	time, because of its duration or azimuth.</small>

    </ul>

There is also a display of the OT's estimate of how long the MSB will 
take.

<!-- 
############################################################################ 
--> <h2><a name="het_eoam">Elements of an MSB</a></h2>

    Click on the push lever to open up your MSB. Inside you will find
    a Het Setup component, a Site Quality component, and an observation 
    component which is labelled "Observation":<p>

<img src="het_images/het_elements.gif" alt="Inside an MSB" ><p>

     We'll now go through these individually. <!-- 
############################################################################ 
-->
    <h2><a name="het_thsc">The Het Setup component</a></h2>

<p> If you click on the "Het Setup" component, the properties of that
 component are shown in the right hand side of the science program
 window (i.e. in the editor panel), as shown below. The purpose of
	  this component is to enable the set up of the required
	  heterodyne instrument and ACSIS prior to
	  an observation. </p>
 

<img src="het_images/het_het_setup.gif" alt="Het Setup component" ><p> <p> 
Four boxes are displayed in the editor panel.

<h3>Front End Configuration</h3>
<ul>
<li> The first item in the Het Setup component enables the user to
		choose the required receiver. Note the tuning
		range, i.e. the frequency range over which the
		selected receiver can be tuned, displayed in the
		top-right corner.

<li> The Bandwidth menu item allows the user to select the required
		bandwidth (in MHz). The resulting spectral resolution
		(in kHz) is shown automatically updated in the "res"
		entry in the Frequency Configuration table at the
		bottom of the Het Setup menu.



<li> The next item allows the user to choose between double sideband
		(dsb) and single sideband (ssb) operation. Note
		receiver A has no single sideband capabilities, so
		"dsb" is the only allowed option.
 
<li> The next menu allows the user to request which sideband is used
		to observe with. Sideband suppression is not absolute
		in the SSB receivers, so the user should avoid, if
		possible, the situation where the unwanted sideband
		corresponds to a frequency where the zenith opacity or
		receiver noise is high. In most cases, however, you
	    should simply select "Best".

</ul>

<h3>Frequency Setup</h3>


 <p>In order to indicate receiver tuning, the user needs to indicate
	      the rest frequency of the spectral line observation.
	      The rest frequency of the line can be set by choosing
	  the required molecule and transition from the pull-down
	  menus, or by entering the frequency manually, in GHz, in the
	  frequency field. Note that manually entering frequency
	  values in the rest frequency field causes the molecule and
	  transition menus take on values of "No Line", even if the
	  frequency does in fact correspond to a known
	  transition. Look-up occurs from molecule/transition to
	  frequency only - no look-up is done in the opposite
	  direction.

<p>When entering the observing frequency manually, it is important to
	  note that the frequency will appear in <font
	    color=red><b>RED</b></font>.  You <b>MUST</b> then click
	  the <b>accept</b> button to the right of the frequency field,
	  for the changes to be implemented.

<p>In addition to indicating the rest frequency of the line, you will
	  need to tell the OT the radial velocity to which the
	  receiver must be tuned.  You have two choices of how to do
	  that:  it can be specified here in the Het. Setup component,
	  or the velocity can be specified in the <a
	    href="#het_tcc">Target Information</a> component.  To
	  specify the velocity in the Het. Setup component, uncheck
	  the "Default tuning velocity to target radial velocity"
	  button (top of the Frequency Setup box in the Het. Setup
	  editor panel), enter the velocity in the Velocity field,
	  select the required Velocity definition and frame from the two
	  pull-down menues, and click the "Accept" button (to the
	  right of the frequency field).  (Note that the velocity will
	  appear in <font color=red><b>RED</b></font> until you click
	  on the Accept button.  Failure to click on the Accept button
	  will mean the velocity you entered will be lost.)  

	    

<p>If your source has a very large radial velocity, there are two ways
	  to deal with this.  The preferred way is to specify the <b>rest</b>
	  frequency of the source in the <i>Het Setup</i> component
	  and enter the radial velocity of the source in the
	  Het. Setup or the <a
	    href="het_tcc">Target Information</a> component, as
	  normal.  The observing system will calculate the correct
	  frequency.  A large redshift might shift the observed
	  frequency out of the tuning range of the receiver, or even
	  into the tuning range of another receiver.  For example,
	  select RxB, CO 3-2, and a redshift of 0.5, and click
	  Accept.  The OT will complain that this is outside of the
	  tuning range.  You can then select RxA, and the correct
	  line, rest frequency and redshift will appear. (Beware! If the
	  redshifted line falls outside of the tuning range of any
	  receiver, the OT will change the rest frequency to something
	  that can fit!)  Clicking on
	  the Frequency Editor button will also show you the
	  atmospheric opacity at the observed frequency.  It's wise to
	  check this since even a minor change in radial velocity can
	  shift the observed frequency into a region of very large
	  atmospheric opacity.

<p>	  Alternatively, you can calculate the observed frequency
	  yourself, and enter that frequency (with a radial velocity
	  set to zero) in the frequency field.  Remember to click the
	  Accept button after entering the frequency.  However, this
	  method is risky unless you <i>really</i> know what you're doing.



 <p>The <i>Frequency Setup</i> configuration also includes a
	      "Frequency Editor" tool. This
 can be useful in setting, choosing your observing frequencies and
 bandwidths, particularly where you might want to observe several
 lines at once with DSB receivers, when using special ACSIS
	      configurations, or to check the atmospheric opacity at
	      the observed (or sideband) frequency.  This section will
	    be updated when ACSIS special configurations become 
supported.<p>

 

<!-- 
############################################################################ 
-->
    <h2><a name="het_tsc">Site Quality</a></h2>
 
    The Site Quality component specifies any weather-related
    scheduling requirements for an MSB. Click on the Site Quality
    component to get the Site Quality panel:<p>

    <img src="het_images/het_site_quality.gif" alt="Site Quality 
Component" ><p>

     Your TAG normally allocates your program a certain range of tau 
(opacity), so you probably don't need to change anything here unless your 
program is using multiple receivers and the TAG-allocated tau range is not 
sufficiently specific for this MSB. You should specify an appropriate 
range of tau to match the demands of the receiver to be used. But beware: 
the resulting range of tau in which the MSB can be observed is then the 
intersect of the TAG allocation and your input: make sure this is not an 
empty set ! <p> The default value of the sub-millimetre seeing is "Don't 
Care".



<!-- 
############################################################################ 
-->
    <h2><a name="het_tsched">Scheduling Constraints</a></h2>
 
<p> The Scheduling Constraints component allows one to restrict or
	    broaden the time over which an MSB will be selected. To
	    insert this component, click on the <i>Component</i>
	    button on the left side near the bottom of the OT window,
	    and select the "Sched. Constraints".  <p>

    <img src="het_images/het_sched_constraints.gif" alt="Scheduling
		Constraints Component" > <p> The main reason you might 
want to insert this component is if your
	      science targets have a very low (i.e. &delta; &lt; ~-35
	      deg) or very high (i.e. &delta; &gt; ~+80 deg)
	      declination.  By default, MSBs are only selected when
	      the sources are above about 30deg elevation, so low- and
	      high- declination sources may never be selected unless
	      you specify a lower minimum elevation.  Similarly,
	      sources at ~19deg declination transit almost directly
	      overhead, and you may wish to restrict such sources to
	      be selected when they're not at extremely high elevations.

<p>Another reason to insert this component is if your observations are
	      time-critical, i.e. they must not be done before a
	      certain date or after a certain date.  This can be
	      specified by changing the Earliest and/or Latest
	      Schedule Date.

<p>You may also need to use this component if you have a project which
	      requires periodic observations, for example if you were
	      monitoring a variable source.  In that case, you can
	      specify the repeat time in the "Reschedule every..." box.
              The MSB will be reactivated at the appropriate time.

<!-- ############################################################################ -->
    <h2><a name="het_tfoc">The Observation component</a></h2>

    Now click on the Observation component to bring up its panel. If you 
recursively open all of the toggle switches, the individual components 
will be displayed as a hierarchy, as shown below.<p>
 
    <img src="het_images/obs_comp.gif" alt="Observation component" ><p>

 The first element inside the Observation component is the "Target
      information" component. Note, however, that it is possible to 
      construct an
      MSB to perform multiple observations on a single target. In
      such a case you would put the Target component outside of, and
      therefore containing, multiple Observation components. Further
      details on this issue of component nesting may be found in the
      section on <a href="./advanced.html">advanced topics</a>.
      Following the Target component is a sequence iterator which
      contains a repeat iterator, then (depending upon the observation
      type) perhaps a chop iterator or an offset iterator - a
      position-switched raster centred on the Target, as in this example,
      needs neither - and then, finally, a single (action) "eye".
      The sequence iterator doesn't do anything <i>per se</i>, but it is
      important to note that it represents the sequence of events at
      the telescope. The repeat iterator allows the user to control
      the number of repeats carried out for a certain observation. The
      "eye"-con represents the observation itself. 
<p>
      The "Flag as calibration" button should be toggled ON if, indeed,
      this observation is intended as a calibration for others.
      This fact is then made known to the TSS who may decide not to 
      execute the observation (er . . calibration) if a suitable
      calibration has recently been done already.

<h2><a name="thingies">Components, Iterators And All That</a></h2>

<ul>

      <li> <img src="images/icon_msb.gif" alt="*">MSBs
      <strong>are</strong> individually schedulable blocks and
      <strong>contain</strong> one or more fully specified science
      observation and any calibrations. For heterodyne observations,
      calibrations will be described in a show-to-observer note.<p>

      <li><img src="images/icon_observation.gif" alt="*">Observations
      <strong>are</strong> observations of a single astronomical
	target and <strong>contain</strong> components and a sequence.<p>

      <li><img src="images/icon_component.gif" alt="*">Components
      <strong>are</strong> configurators for the JCMT systems such as
      the instrument (het setup component), the telescope (Target
      component) and the scheduler (Site Quality component). <p>

      <li><img src="images/icon_iterator.gif" alt="*">Iterators
      <strong>are</strong> potentially multiple actions and
      <strong>contain</strong> other iterators and one or more
      eyes.<p>

      <li><img src="images/icon_eye.gif" alt="*">Eyes
      <strong>are</strong> actions that results in the actual taking
      of data - a single data file per eye to be precise.<p>


      <li><img src="images/icon_note.gif" alt="*">Notes
      <strong>are</strong> a repository of useful information and can
      go anywhere.<p>

</ul> <!-- 
############################################################################ 
-->
    <h2><a name="het_tcc">The target component</a></h2>

    Click on the target component to bring up its panel:<p>
    
   <img src="het_images/het_target.gif" alt="The Target component" ><p>

<p>In this component you will enter the coordinates and velocity of
	      the source, and the coordinates of the reference
	      position (for position-switched observations).

<p>The "Target Type" is a pull-down menu that allows you to select
	      RA/Dec (most common), Orbital Elements (for comets,
	      etc.), or a Named Planet.  The window changes for each
	      selection.

<p>For RA/Dec targets, enter the R.A. and Dec. in the appropriate
	      boxes, using colons as separators.  One of several
	      different coordinate systems can be selected with
	      another pull-down menu, such as J2000, B1950, etc.  

<p>It is now necessary to specify the radial velocity of the source in
	      the target component, either as a radio, optical, or
	      relativistic velocity, or redshift (z).

<p>To specify a reference position, click on "REFERENCE".  The default
	      is to enter the offset (in arcseconds) from the source
	      position, but by unchecking the "Offset" button, you can
	      enter an absolute position for the reference.

      
<p>Instead of entering the source coordinates manually, if you are using
      a machine with an Internet connection you can try entering the name
      of your target (in our example the IRAS source 18592+0108),
	      select the on-line catalogue to search (i.e. SIMBAD or
	      NED) from the pull-down menu, and
      hit "Resolve Name".

      After a brief pause the RA and DEC co-ordinate fields are
      populated with the SIMBAD/NED co-ordinates for the source. The
      SIMBAD/NED name for the source will also be indicated next to the
      "Resolve Name" button.  And of course, double check that the
      co-ordinates are those you intend to observe.<p>
       
<p>WARNING: Positions of astronomical objects are often wavelength-biased.
   Any catalogues you may use will have defined astrometric positions
   on the basis of their optical- or infrared- or radio- positions.
   You should check that the positions obtained from these sources
   are valid for your submillimetre studies.<p>

<!-- N.B. Not all ACSII characters are allowed in the target name -
      make sure your target name is built up of only the following
      characters A-Z, a-z 0-9,+,- and _. -->


      But wait - that's not all.<p> <!-- 
############################################################################ 
-->
    <h2><a name="het_tpe">The position editor</a></h2>

    You can <a href="#het_tci">skip</a> this section if you want because 
you don't have to do
    anything, but it's kind of cool and can be very useful in picking
    a good chop position. Click on the plot button at the bottom left
    of the target panel:<p>

      A whole new window will pop up - this is the position
      editor. Looks a bit boring at the moment though, with just a
      small green crosshair in the middle. Let's make it a bit more
      interesting - go to Catalog menu and into the Image Servers item
      and chose a Digital Sky Survey near near you:<p>

   <img src="het_images/het_tpe.gif" alt="The Position editor"><p>

      It's now full of stars. The display application, by the way, is
      is based on JSky, for those familiar with it. <p>

      If you're having problems with the position editor, the most likely 
explanation is that your version(s) of JRE, JAI and/or java may not be 
sufficiently up-to-date; check the <a href="download.html">download 
page</a> for more information.  If you are behind a firewall, you may need 
to check your <a href="advanced.html#proxy">proxy server settings</a>.<p>

      The DSS may not be the most useful survey for planning
      sub-millimetre observations, but you can read in any FITS image
      with an appropriate WCS header using Open under the File
      menu. You can also fetch a FITS image over the Web.

      In the screenshot below I have loaded the SCUBA commissioning
      scan map of W48 <em>(image courtesy Tim Jenness)</em>. If you
      have an Internet connection, go to the File menu, select "Open
      URL...:" and type in the following URL: <a
      
href="http://www.jach.hawaii.edu/software/jcmtot/w48.fits">http://www.jach.hawaii.edu/software/jcmtot/w48.fits</a>
      or download the image by clicking on the link and and use
      File-&gt;Open to read it in. Notice that the RA/DEC position
      fields of the target component must be set reasonably near to
      the world co-ordinate of the FITS file otherwise the image may
      not load properly.<p>

      <img src="images/w48.gif" alt="W48"><p>

      You will then see the DSS image replaced with the sub-millimetre
      image.<p>

      <blockquote>
      <small>A short technical note if you are planning on generating your 
own
      image for import: if you want to import a SCUBA map in NDF format,
      convert it to FITS by using the <a
      href="http://www.starlink.ac.uk">Starlink</a> <a
      
href="http://www.starlink.rl.ac.uk/star/docs/sun55.htx/sun55.html"><tt>convert</tt></a>
      utility with the following arguments:

<pre>ndf2fits encoding=FITS-IRAF bitpix=32 comp=D</pre>

    If you have difficulty despite doing this, let us 
know.</small></blockquote>


    <p>As I mentioned before, the green cross-hair is the position of
    your science co-ordinates. Click on the button on the left side of
    the position editor entitled "Sci Area". The circle that is drawn
    is the HPBW of the chosen heterodyne receiver.<p>

    Now for the useful thing I mentioned earlier. While leaving the
    position editor window open, go back to your science program
    window and click on your chop iterator that is inside your science
    observation. Now look at the position editor. The chop beams and
    the area in which they will rotate during integration are
    drawn. Well, that's no good - we're chopping onto bright stuff!
    <p>

 <img src="het_images/het_bright_chop.gif" alt="bright stuff"><p>

    This is where the position editor comes into its own. We are going
    to use it to specify where exactly we would like to chop. In the
    chop iterator, use the drop down menu to change the chopping
    co-ordinate frame from AZEL to TRACKING (i.e. RA/DEC). You will
    notice that in the position editor the uncertainty circles have
    disappeared, since we will always chop in the same position in the
    sky:<p>

      <img src="het_images/het_tracking_chop.gif" alt="Chop and the 
Position Editor"><p>
	   
 Now back in the position editor, click on the Drag button on the
 upper left side of the window. Then click on the centre of one of the
	   chop beams in the display and drag it away from the 
emission:<p>

      <img src="het_images/het_tracking_chop2.gif" alt="Dragging the 
Chop"><p>

      You will note that the values in the chop iterator have
      automatically changed to reflect the new chop throw and angle
      values. Neat, eh? Remember that by default, any calibrations for
      your observations will be performed with the same chop as the
      science observation. <p>

      You can also click on the target component and use Drag to
      change your science co-ordinates if you wish. <!-- 
############################################################################ 
-->

    <h2><a name="het_tci">The chop iterator</a></h2>

    Click on the chop iterator:<p>


    <img src="het_images/het_chop.gif" alt="The Chop Iterator" ><p>

      The chop iterator has a list of chop configurations (in this
      example only one 60 arcsecond chop). Each chop needs to be
	      specified by a throw,
      an angle, and co-ordinate frame of the angle. In this example
      the frame is AZEL (Azimuth Elevation) but other common options
      are TRACKING (RA & Dec) or FPLANE (Focal Plane). A 60 arcsecond
	  chop with an angle of 90 degrees AZEL
      (i.e. 60 arcsec in the azimuth direction) is typical for
      beamswitched observations of compact sources. If the source is
      extended, one might want to increase the chop throw, or if the
      source was elongated in one direction on the sky, chop in a rotated
      direction relative 
      to the RA/DEC frame. The maximum recommended chop throw is 180 arcsec.
      There is a software limit of 240 arcsec. Chopping with large throws
      is less efficient than using small throws and also there will be
      a slight distortion of the beam due to observing off-axis. 
      Clicking on Add one can add chop configurations. Each configuration
      will result in a separate observation (and data file). 
      <p>

<!-- 
############################################################################ 
-->

    <h2><a name="het_offset">The offset iterator</a></h2>

<p>It's often very useful to be able to specify a position with the <a
	    href="#het_tcc">Target component</a>, but to take an
	  observation at a position offset from that specified.  That
	  can be done with the "offset" iterator.  In addition, with
	  <a href="#het_grid_folder">Grid maps</a>, a whole series of
	  offsets can be specified in either a regular or irregular
	  spacing.

<p> <img src="het_images/het_offset1.gif" alt="The Offset Iterator (1)" >

<p>If an offset iterator is not already specified in the MSB, one can
	  insert it below the Sequence iterator <img
	    src="images/icon_iterator.gif" alt="*">, usually just
	  above the photom/sample "eye"-con <img
	    src="images/icon_eye.gif" alt="*">.  Click on the iterator
	  below which the offset iterator is to be inserted (the
	  'chop' iterator in the image above), then click on the
	  iterator menu on the left-hand panel of the OT window and
	  select the offset iterator.  Be sure to "drag" the
	  photom/sample eye-con to the right, so that it is indented
	  with respect to the offset iterator (see figure above).

<p>The offset is specified in arcseconds in the 'p' and 'q' boxes.
	  Note the orientation of these axes to the left of the
	  'Title' box.  In an unrotated frame, 'p' is in the positive
	  r.a. direction (i.e. east) while 'q' is in the declination
	  direction (i.e. north).  If a rotated frame is required,
	  enter the position angle (measured east of north) in the
	  'PA' box.  If you then click on the 'Display Rotated
	  Offsets' button, the specified offsets in the unrotated
	  frame will be briefly displayed in the table above.

<p>To add more offsets, click the 'New' button, and enter the offset
	  in the 'p' and 'q' boxes as above.  Repeat for as many
	  positions as required.

<p>A regular grid can also be specified using the 'Grid Pattern'
	  section of the window.  See the section on <a
	    href="#het_grid_folder">Grid Maps</a> for a description.
          Note that all offsets at the JCMT are defined in the Gnomonic
          (TAN) projection.

<!-- 
############################################################################ 
-->
 <h2><a name="het_sample">The photom/sample eye</a></h2>

  The science observation itself is represented within the MSB by the
 photom/sample eye. Click on it to display the details of the
 observation. The pull down menu near the top of the right hand frame
 allows the user to choose from beam switching or position switching.
 In this example we are
	    beam-switching, and the chop throw was set with the <a
	      href="#het_tci">chop iterator</a>.  In the "Secs per offset
	    sample" box, enter the <b>total on-source integration time</b>
	    per sample position in seconds. 
           (Note this is different from how it's
	    been done in the past when we specified the on+off time.) 
            The estimated RMS noise per channel is shown in the "Noise" box.
            Typical recommended on source integration times per sample are 5 to
            10 minutes. We advise to use no observing times >15 minutes, at
            the risk of loosing observations when something goes wrong. 
 The Continuum Mode box can be checked if you want to observe a continuum
 source (e.g. planet) and then the SMU will chop faster (4 Hz instead of
 1 Hz) in order to more accurately subtract the sky background
<p>

 <img src="het_images/het_eye.gif" alt="The photom/sample eye" ><p>

<p> <!-- 
############################################################################ 
-->
    <h2><a name="het_time">The repeat iterator and integration time in 
general</a></h2>

    Back to your Science Program window now. Click on the Repeat
    iterator. It's only property is a repeat counter:<p>

      <img src="het_images/het_repeat.gif" alt="The Repeat Iterator" ><p>

      The repeat iterator acts on things that are
      <strong>inside</strong> the repeat iterator (i.e. indented under
      it) in turn. So if you set it to 2, your science observation
      consist of two spectral line samples i.e you will end up with
      precisely two spectral line observations. If you require a long 
      integration of a
      source, it makes sense to break the observation down into
      shorter integrations of around ten minutes or so, so that data
      quality can be assessed as the observation progresses. In
      practice, you set up the integration time required per spectral line
      observation
      using the photom/sample eye and then use the repeat iterator to
      define a sufficient number of repeats to give the total required
      integration time.<p>

      Now you can see how your time usage builds up. Working our way
      inside out (and bottom to top): <p>

<ul>
      <li><img src="images/icon_eye.gif" alt="*"> The photom/sample
      eye is set to an on-source integration time (and shows you the
      estimated RMS noise) which will end up in a single file.<p>

      <li><img src="images/icon_iterator.gif" alt="*">The Repeat
      iterator multiplies the number of times the sample is carried
      out. If you increase it from the default of 1, don't forget to
      take that into account when calculating how deep you will go.<p>

      <li><img src="images/icon_component.gif" alt="*">The observation
      component shows you the estimated time of the sequence it
      contains.<p>

      <li><img src="images/icon_msb.gif" alt="*">The MSB component
      will give you the estimated time of the observations inside
      it. For the heterodyne OT, you only need to define MSBs for
      your science observations. Obviously, before the observation,
      the TSS will tune the receiver (when necessary), focus the telescope, 
      and do a pointing observation. Specific calibration
      instructions, for example, the observation of a spectral line
      standard and/or a planet should be described in the note attached
      to the MSB. Be sure to remember to click the show-to-observer
      tick box for the note. In conclusion, the estimated time for an MSB 
only includes
      observations of the science target - one should remember there
      will be instrument set up and calibration overheads on top of
      this when planning your observing program.<p>

      <li><img src="images/sci_prog.gif" alt="*">The Science Program will 
give you the estimated time of all
      MSBs inside it including the number of repeats. So if you have a
      1hr MSB (as in this example) and you set the MSB counter to 2,
      your MSB estimated time will be 1hr and your Science Program
      time will show 2hrs.
      Remember that different MSBs may be observed on different nights, 
      whereas observations within a single MSB will be observed within a
      aingle night. 
</ul>

<h2> <a name="het_note">Adding information in "Note" elements 
</a></h2>


  By default, the heterodyne library MSBs contain one note element at
 the beginning of the MSB. This consists of a text window where you
 can include textual information, with the option of showing the note
 to the observer and TSS at the time the observation is made. If you
 click on the note icon, the right hand panel allows you to enter the
 name of the note and the main text body of the note. The
 "Show to observer" check-box should be checked if you want the
 note to be visible for the observer/TSS at the time of
 observation. It is strongly recommended that each of your MSBs
 contains at least one "Show to observer" note. All of the information
 about the observation not covered by other elements of the MSB should
 be included in "show to observer" notes. This would be much of the
 material which would have previously gone into the "Overall Strategy"
 and "Observing Cookbook" sections of heterodyne observing
 templates. It is important to note that calibration details are
 not explicitly included in heterodyne MSBs as they are for SCUBA MSBs, so
 the heterodyne observer should spell out the required calibration
 observations in a "show to observer" note.<p>

 <img src="het_images/het_note.gif" alt="A note example" ><p>


 Setting the "Show to observer" tick box brings up a "Completion
 Parameter" and "binning" field. These should contain information which
 enables the observer and TSS to decide when to consider your
 observation to be complete. The "Completion
 Parameter" should include a value for the total
 expired time, or a required signals-to-noise or RMS noise value. The
 assumed bin size, either in km/s or MHz, should be entered in the
 "Binning" field. The above screenshot shows an example of a typical "Show 
to
 observer"  for an extragalactic spectral line observation.<p>

 Additional notes can be inserted at any point in the MSB from the
 icon menu and you may have more than one "show to observer" notes in
 an MSB. For example, you could choose to insert a "show to observer"
 note above the "chop" element to clarify the use of an unusual
 chopping scheme.<p>

    Finally, there is no need to repeat information in notes that is 
already included
   in other components of the MSB. This might include receiver tunings,
   chop throws, offset positions and science targets. All of these
   should be set up in the appropriate MSB components. If they are
   reproduced in notes, there is a risk that changes made to main body
   of the MSB will not be reflected in the notes, leading to conflicts
   between the notes and the MSB components resulting in confusion at
   the telescope.<p>
 
<!-- 
############################################################################ 
--> <h2><a name="het_summary">Summary: Making your heterodyne MSB</a></h2>

 So far, I have described, the various elements of the MSB. I'd like
 to summarise the general procedure for making your own.<p>

<ul>

<li> Choose the corresponding MSB template from the heterodyne library and 
copy/paste it to your science program.  Each of these is described
		briefly <a href="#het_supported">below</a>.

<li> Fill out the het setup component with the frontend/backend details 
for your observation.

<li> Set up the site quality component, normally this means simply leaving 
the "allocated" button checked.

<li> Enter the target information for your target. This step can be as 
simple as entering the RA/DEC and epoch. Don't forget there are the useful 
tools of the Name resolver and the position editor to help you out here.

<li> Set up the chop iterator. Again this can simply mean entering the
chop throw angle and reference frame, or this iterator can be set up
via the position editor.

<li> Set up the photom/sample eye. Remember to enter the total
	    on-source integration time per sample.

<li> Set up the repeat counter to give the number of repeats of the time 
set up in the photom/sample eye to get your total required integration 
time. If you want a total integration of one hour on-source, you
	    should set up an  
integration time of 5 minutes in the photom/sample eye and set the repeat 
counter to twelve. When observing, you can then monitor the observation by 
inspecting the data file produced every ten minutes, and co-add the spectra 
as you go along. In general, if you want to build up long integrations, 
you will want the basic sample length to be around 10 minutes for RxW and 
RxB and around 15-20 minutes for RxA.

<li> Add at least one "show to observer" note. This should contain 
additional information on the overall aims of your science program, 
details of required calibrations and any other special notices you want 
the observer and TSS to act upon when the observation is made.

<li> Click on the outermost level of the MSB. In the right hand panel you 
should give the MSB a meaningful name. Below the name field, there is pull 
down menu labeled "Observe". This counter allows you to control how many 
times you want the whole MSB observed. If you want it done just once, 
leave this as (1x). You can set the relative priority of the MSB within 
your science program using the "Priority" pull down menu. Set this between 
1 and 99, with 1 signifying the highest priority. </ul>

 That's pretty much all you need to know to start preparing your
 MSB. The remainder of this primer covers the rest of the Heterodyne
 MSB library and the frequency editor tool in the heterodyne setup
 component. <!-- 
############################################################################ 
-->

<!-- 
############################################################################ 
-->
 <h2><a name="het_freq_ed"> The frequency editor</a></h2>

<i>{This section is out of date.}</i>

 <p>While many users will simply complete the Het-setup component quite
 adequately following the procedure outlined above, the het-setup 
component includes the
 "frequency editor" tool which will prove useful to some observers -
 particularly those observing multiple spectral lines in a single
 program. To activate the tool simply, click on the "Show frequency
 Editor" button in the het-setup component.<p>


<img src="het_images/het_freq_ed.gif" alt="The frequency editor" 
width="100%"><p>


 Starting at the top of the window we see a rectangle labelled LSB on
 the left and a rectangle labelled USB on the right. In between these
 two rectangle we have indication of the receiver IF frequency, the
 currently selected bandwidth and the resolution. Below these items there
 is a frequency scale and vertical lines indicating the position of
 astronomical spectral lines. Below this frequency scale is a plot 
indicating the
 atmospheric transmission as a function of frequency. Below this is a
 frequency scale labelled "FE frequency" and below this is a scale and
 slider labelled "LO1".<p>

  The chief idea of the frequency editor is to give a visual
  representation of the observing band selected for the receiver,
  together with an indication of the spectral lines visible in that
  band. To begin with, use the het-setup component to select RxB3, the
  CO(3-2) transition, and ssb operation observing with the lower
  sideband (lsb). Enter a velocity of 0 km/s. The frequency editor
  will now show USB rectangle greyed out, and the LSB rectangle
  highlighted. Try changing the bandwidth using the "BW" pull-down
  menu. Notice that the textured lilac rectangle in the middle of the LSB
  rectangle changes size, indicating the extent of the band on the
  frequency scale directly below. Notice also that a spectral line is
  highlighted in red at the centre of the band. This is the CO(3-2)
  line you selected before opening the frequency editor tool. Now select a
  bandwidth of 920 MHz. The band, indicated by the textured lilac
  rectangle, can be seen to encompass several other spectral lines. If
  you click and hold the right mouse button near the spectral lines, a 
menu will
 appear. Moving down the menu, still keeping the right mouse button
  held down, highlights the name of a spectral line on the menu and
  causes the corresponding spectral line to be highlighted in green on
  the frequency scale. This enables the identification of the spectral
  lines which may be visible in your chosen receiver passband.<p>

    The frequency scale at the bottom of the window, labelled "FE
   freq", corresponds to the observing frequency in the rest frame of
   the receiver. This is just the LO frequency plus/minus the IF
   frequency for the upper and lower sideband, respectively. The
   frequency scale immediately below the spectral lines is the "FE
   freq" doppler shifted by the velocity value and definition entered
   in the het-setup component. You will notice this scale will shift
   if you enter a non-zero velocity, and will also shift if you cahnge
   the velocity definition, e.g. from radio to optical. Note the
   frequency of the upper scale, lower scale and LO are only
   approximate because the correction from the receiver rest frame to
   the chosen rest frame cannot be made, since the time when the
   observation will be made is unknown. In fact, if you really enjoy
   working backwards, you can move the LO slider by dragging it while
   pressing the left and right mouse buttons simultaneously. As you
   might expect, this changes both frequency scales and the line rest
   frequency. Moving the LO slider can be a convenient means of choosing
   a band centre frequency such that particular spectral lines are
   included or excluded from your passband. Remember, for making the
   observation, the important parameters are the rest frequency,
   velocity, rest frame and velocity definition. These will be used to
   calculate the actual LO tuning at the time of observation, which
   will depend on the relative velocities of the receiver and the
   chosen rest frame at that time.<p>

     The frequency editor tool is particular useful when it comes to
     receivers operating in double sideband mode, where two differing
     sky frequencies end up with the same IF frequency. In this case,
     identifying spectral lines can be tricky since one does not know,
     <em> a priori</em>, which sideband they are from. Choose RxA, which 
has no
     sideband suppression capabilities, from the pull-down menu on the
     het-setup component. Notice that neither LSB nor USB rectangles
     are greyed out, indicating that lines from both sidebands may be
     visible in the IF passband. The apparent position of lines from
     the image sideband are a function both of the rest frequency and
     source velocity of the line chosen to be at the centre of the
     signal sideband. The frequency editor gives a useful graphical
     reperesentation of this effect, allowing one to either choose
     observing frequencies to avoid contamination, or identify unknown
     lines in the passband. The fact that the sky transmission and
     receiver noise are shown in the frequency editor tool allows the
     user to reliably choose between upper and lower sidebands when
     observing in SSB mode.<p>

     The frequency editor tool is also useful when using non-standard
     DAS configurations. As an example, choose NS_COHCN_125AB from the
     non-standard configuration menu. This mode is designed to allow
     the user to observe the CO(3-2) and HCN(4-3) lines simulataneously 
using the
     highest resolution 125 MHZ DAS mode. This is achieved by
     adjusting both the frontend LO frequency (to move the lines
     closer together) and the DAS LO frequency (to centre the
     subsystem on the two lines). In the frequency editor this is
     represented by a shifting of the bands covered within the LSB and
     USB sliders. You can use the spectral line identification menu to
     confirm that CO(3-2) appears in the lower sideband and upper
     sideband. Some DAS modes, e.g. NS_H2CO_125X4, use the different
     sub-bands of the DAS independently to provide a coverage useful
     for measuring two closely spaced lines accurately. If you choose
     one of these modes from the pull down menu, you will see that the
     coverage of the DAS subbands is represented by multiple LSB and
     USB sliders. If you select NS_H2CO_125X4, you should be able to
     confirm, using the line identification menu, that this
     configuration enables the simultanaeous observation of the H2CO
     lines at 218.22 GHz and 218.48 GHz with the highest DAS frequency
     resolution.  Please consult this <a
     
href="http://www.jach.hawaii.edu/JCMT/spectral_line/Backends/DAS/das_nonstandard.txt">
     list </a> of non-standard modes DAS modes, and the <a href
     
="http://www.jach.hawaii.edu/JCMT/spectral_line/Backends/DAS/DAS_guide/das-guide.html">
     DAS USER guide </a> for further information when planning your 
observation.

<h2><a name="het_msblib">The Heterodyne MSB library</a></h2>

<p> The heterodyne library groups the MSB templates according to whether
 the observation is to be a sample, a grid, a raster, or a jiggle
	    map.  This last mode is new to heterodyne observing, but
	    should be familiar to SCUBA observers. For samples
 and grids, the user can choose beam switching, position switching or
 fast or slow frequency switching.  Jiggle mapping uses beam-switching
	    or frequency switching (although the latter has not yet
	    been tested), and raster observations only
 allow position switching. The similarities and differences of the
 heterodyne library MSBs will be discussed below.

<ul> <li><a href="#het_sam_folder">Single-spectrum samples</a>
  <ul><li>An old, familiar observing mode, where a single spectrum is
		    obtained toward a single position.  </ul> <li><a 
href="#het_grid_folder">Grid maps</a>
  <ul><li>Another familiar observing mode, grid mapping are used where
		  relatively small maps are required with longer
		  integration times per point.</ul> <li><a 
href="#het_jig_folder">Jiggle maps</a>
  <ul><li>This mode is new to heterodyne observing at the JCMT, and
		  specifically designed for HARP although useful for
		  single "pixel" receivers as well.  This mode makes a
	      small map where the secondary mirror "jiggles" rapidly
		  over all the points in the map.</ul> <li><a 
href="#het_rast_folder">Raster maps</a>
  <ul><li>This mode is useful for making large maps rapidly.</ul> </ul>


<h3><a name="het_sam_folder"> Samples</a> </h3>

 A sample denotes an observation consisting of one pointing per science
 target, and can be beam switched, position switched, fast frequency
 switched or slow frequency switched. If you open up the position
 switched sample MSB in the heterodyne library, you will see that it
 contains the same elements as the beam-switched MSB, with the
 exception of the "chop" component. Opening the "Target Information"
 component, however, reveals two rows in the bottom right hand
 window, a SCIENCE and a REFERENCE row. Clicking on one of them allows
 the user to specify the co-ordinates of either the SCIENCE, or "on"
 position, or the REFERENCE or "off" position. The REFERENCE position
 can either be specified as a co-ordinate offset from the SCIENCE
 position, by checking the "offset" tick-box, or as an absolute
 co-ordinate, by leaving the "offset" tick-box unchecked.<p>

 For the Fast and slow frequency switching MSBs, one does not specify
 a chop or offset position, rather one specifies a frequency throw
	    within the modified "Photom/Sample" eye.  <p>

For all sample modes, the <i>total</i> integration time per sample is
	    indicated in the "Photom/Sample" eye.

<p> <h3> <a name="het_grid_folder">Grid Maps</a> </h3>

 Observations of a single science target, at multiple positions are
 generically referred to as Grid observations. Note that the user
 can define exactly the position offsets required from the map centre,
 and there is no requirement that the pointings form a regularly
 shaped grid. Opening the various grid MSBs in the heterodyne library
 shows they are similar to the sample MSBs except for the addition of
 an "offset" iterator. This iterator enables the user to specify the
 required pointings for the observation. <p>

 Suppose the user requires three pointings along the long axis of a
 galaxy, at a half beam width spacing of 10 arcseconds. Let us assume the 
long axis of the
 galaxy has a position angle of 30 degrees on the sky. First enter the
 position angle in the "P.A." field. The rotated frame has axes
 labeled p and q, so in order to obtain the required pointings along
 our galaxy we require (p,q) offsets of (0,-10), (0,0) and (0,10). One
 adds a new pointing by clicking on the "new" button. One then modifies
 the offsets via the p and q boxes directly above the "new"
 button. The highlighted pointing can be removed using the "remove"
 button. The "Rm. all" button removes all of the user-added
 pointings. The arrow buttons to the right of the box displaying the
 pointings allow the pointings to be re-ordered. The highlight pointing
 can be advanced one position up or down the pointing list, or to the
 top or bottom of the list by clicking on these arrow buttons. For our
 example, the completed offset iterator will appear as shown below. <p>

 <img src="het_images/het_offset1.gif" alt="The Offset Iterator (1)" ><p>

  If you want to see what the rotated offsets are in the sky
  frame (which will be the co-ordinate frame specified in the "target
  information" element), click and hold the "Display Rotated Offsets"
  button.<p>

  The offset iterator has the ability to automatically generate
  regularly spaced grids without the need to enter each pointing
  individually. The "Grid Pattern" section of the "Offset iterator"
  allows the user to specify the offset of the map centre (relative to
  the co-ordinate in the Target information box), the grid point
  spacing and the dimensions of the grid, in grid points. To create a
  3x3 grid, with a ten arcsecond spacing, one would fill in the fields
  of the grid pattern section as ilustrated below, and then click on
  either "Create" or "Create/Centre on Base" button. The pointings
  generated then appear in the pointing list box above. Notice that
  "Create" created a grid where the (0,0) point is at the top left
  hand corner of the map, whereas "Create/Centre on Base" chooses the
  point the geometrical centre of the grid for the (0,0) position. This 
will only
  correspond to a pointing position for grids with odd p and q dimensions. 
The
  screenshot below show the result of clicking on the "Create/Centre
  on Base position" - nine points with the (0,0) position corresponding
  to the map centre. <p>

<img src="het_images/het_offset2.gif" alt="The Offset Iterator(2)"
	      ><p>

<h3> <a name="het_jig_folder">Jiggle Mapping</a> </h3>

<i>{This section needs to be written.}</i>

<h3> <a name="het_rast_folder">Rasters</a> </h3>

 The format of the position switched raster MSB is similar to the
    sample MSB, except that the "photom/sample" eye is replaced by the
    "scan/raster" eye. If you click on the "scan/raster" eye, you will
    be presented with options which enable you to set up your
    raster map. The "Area" panel on the left has a number of fields
    which allow you control the size and sampling of the raster
    map. The width and height of the map are set through the "width"
    and "height" records. The sample spacing and grid spacing and the
    postion angle of the map on the sky can also be set up by making
    entries in the appropriate records. Suppose, for example, that you
	  want to use RxA to make a 35x5 pixel map with cell size
	  7"x7".  Set the sample spacing and the scan spacing to be
	  7", then specify a map width of 238 arcsec and height of
	  28".  <p>

<img src="het_images/het_raster.gif" alt="Rasters" ><p>

  The sample time box allows the user to set the amount of
 time data is taken for for each map "point" as the receiver is
 scanned across the sky.  The RMS noise per channel of the final
	    co-added map is also indicated, as is the estimated time
	    to complete each row and the complete map.

<p>It is possible to set the scanning direction, but for most purposes
	    this should be left to the default values.


    <hr> <h4> <a href="otintro.html"> <em>Back to JCMT OT Primer Main 
Page</em></a> </h4>
  </body> </html>
